<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../i18n-behavior/i18n-behavior.html">

<dom-module id="my-view3">

  <template>

    <style>
      :host {
        display: block;
        padding: 10px;
      }
      .card {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        padding: 16px;
        margin: 24px;
        border-radius: 5px;
        background-color: #fff;
        color: #757575;
      }
      .circle {
        display: inline-block;
        height: 64px;
        width: 64px;
        border-radius: 50%;
        background: #ddd;
        line-height: 64px;
        font-size: 30px;
        color: #555;
        text-align: center;
      }
      h1 {
        font-size: 22px;
        margin: 16px 0;
        color: #212121;
      }
    </style>

    <div class="card">
      <div class="circle">3</div>
      <h1>View Three</h1>
      <p>Modus commodo minimum eum te, vero utinam assueverit per eu.</p>
      <p>Ea duis bonorum nec, falli paulo aliquid ei eum.Has at minim mucius aliquam, est id tempor laoreet.Pro saepe pertinax ei, ad pri animal labores suscipiantur.</p>
      <iframe id="subDocument" src="sub-document.html" width="80%" height="400"></iframe>
      <iframe id="srcdocStaticEmpty" srcdoc="" width="80%" height="100"></iframe>
      <iframe id="srcdocStaticFullHtml" srcdoc="<html><head><script src=&quot;../../chai/chai.js&quot;></script><script>chai.assert.throws(()=> { return caches; }, /^Permission Denied:/);</script></head><body><p1>srcdocStaticFullHtml</p1></body></html><script>console.log(`srcdocStaticFullHtml srcdoc loaded`);</script>" width="80%" height="100"></iframe>
      <iframe id="srcdocStaticHtmlOnly" src="overidden.html" srcdoc="<html><script src=&quot;../../chai/chai.js&quot;></script><script>chai.assert.throws(()=> { return caches; }, /^Permission Denied:/);</script><p1>srcdocStaticHtmlOnly</p1></html>" width="80%" height="100"></iframe>
      <iframe id="srcdocStaticBare" onload="console.log('srcdocStaticBare onload event', event);" srcdoc="<script src=&quot;../../chai/chai.js&quot;></script><script>chai.assert.throws(()=> { return caches; }, /^Permission Denied:/);</script><p1>srcdocStaticBare</p1>" width="80%" height="100"></iframe>
      <iframe id="srcdocStaticRecursive" srcdoc="<iframe id=&quot;innerIFrame&quot; srcdoc=&quot;<script src=../../chai/chai.js></script><script>chai.assert.throws(()=> { return caches; }, /^Permission Denied:/);</script><p1>innerIFrame</p1>&quot; width=80% height=100></iframe>" width="80%" height="100"></iframe>

      <iframe id="srcEmpty" width="80%" height="100"></iframe>

      <iframe id="setSrcdocAttribute" width="80%" height="100"></iframe>

      <iframe id="setSrcdocProperty" width="80%" height="100"></iframe>

      <iframe id="setSrcAttributeJavascript" width="80%" height="100"></iframe>

      <iframe id="setSrcPropertyJavascript" width="80%" height="100"></iframe>

      <iframe id="srcEmptyOnload" onload="chai.assert.throws(() => { this.contentWindow }, /^Permission Denied:/); chai.assert.throws(() => { this.contentDocument }, /^Permission Denied:/)" width="80%" height="100"></iframe>
    </div>

  </template>

  <script>

    Polymer({

      is: 'my-view3',

      behaviors: [ BehaviorsStore.I18nBehavior ],

      attached: function() {
        let iframe = this.$.subDocument;
        iframe.addEventListener('load', function (event) {
          chai.assert.throws(() => {
            iframe.contentWindow.caches;
          }, /^Permission Denied:/);
        });
        this.$.srcdocStaticFullHtml.addEventListener('load', function (event) {
          console.log('this.$.srcdocStaticFullHtml.addEventListener("load") event called');
        });
        this.$.srcdocStaticHtmlOnly.onload = function (event) {
          console.log('this.$.srcdocStaticHtmlOnly.onload event called');
        };
        chai.assert.throws(() => {
          this.$.srcEmpty.contentWindow;
        }, /^Permission Denied:/);
        chai.assert.throws(() => {
          this.$.srcEmpty.contentDocument;
        }, /^Permission Denied:/);
        this.$.setSrcdocAttribute.setAttribute('srcdoc', 
          '<script src="../../chai/chai.js"></scr' + 'ipt>' +
          '<script>chai.assert.throws(() => { caches }, /^Permission Denied:/);</scr' + 'ipt><p1>setSrcdocAttribute</p1>');
        this.$.setSrcdocProperty.srcdoc =
          '<script src="../../chai/chai.js"></scr' + 'ipt>' +
          '<script>chai.assert.throws(() => { caches }, /^Permission Denied:/);</scr' + 'ipt><p1>setSrcdocProperty</p1>';

        // ignored
        this.$.setSrcAttributeJavascript.setAttribute('src', 
          'javascript:document.write(`<script src="../../chai/chai.js"></scr' + 'ipt>' +
          '<script>chai.assert.throws(() => { caches }, /^Permission Denied:/);</scr' + 'ipt><p1>setSrcAttribute</p1>`)');
        chai.assert.throws(() => {
          this.$.setSrcAttributeJavascript.contentWindow;
        }, /^Permission Denied:/);
        chai.assert.throws(() => {
          this.$.setSrcAttributeJavascript.contentDocument;
        }, /^Permission Denied:/);

        // ignored
        this.$.setSrcPropertyJavascript.src = 
          'javascript:document.write(`<script src="../../chai/chai.js"></scr' + 'ipt>' +
          '<script>chai.assert.throws(() => { caches }, /^Permission Denied:/);</scr' + 'ipt><p1>setSrcAttribute</p1>`)';
        chai.assert.throws(() => {
          this.$.setSrcPropertyJavascript.contentWindow;
        }, /^Permission Denied:/);
        chai.assert.throws(() => {
          this.$.setSrcPropertyJavascript.contentDocument;
        }, /^Permission Denied:/);

        // dynamic
        let dynamicIframe = document.createElement('iframe');
        dynamicIframe.srcdoc = '<script>console.log("script in dynamicIframe");</scr' + 'ipt><p1>dynamicIframe</p1>';
        dynamicIframe.onload = function (event) {
          console.log('dynamicIframe.onload event handler called');
        }
        dynamicIframe.setAttribute('width', '80%');
        dynamicIframe.setAttribute('height', '100');
        Polymer.dom(Polymer.dom(this.root).querySelector('.card')).appendChild(dynamicIframe);
      }

    });

  </script>

</dom-module>
